# ==============================================================================
# PhilGEPS Frontend Service - Docker Compose
# ==============================================================================
# Frontend static site served by Nginx
# Deploy this on your frontend cloud service
#
# Usage:
#   docker compose -f docker-compose.frontend.yml up -d
#
# Requirements:
#   - .env file with VITE_API_URL pointing to backend
# ==============================================================================

services:
  # ==============================================================================
  # Frontend (React + Vite + Nginx)
  # ==============================================================================
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.standalone
      args:
        # Backend API URL - must be accessible from user's browser
        VITE_API_URL: ${VITE_API_URL:-http://localhost:3200}
    image: philgeps-frontend:latest
    container_name: philgeps-frontend
    ports:
      - "${FRONTEND_PORT:-3000}:80"
    networks:
      - philgeps-frontend-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:80/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

# ==============================================================================
# Networks
# ==============================================================================
networks:
  philgeps-frontend-network:
    driver: bridge
    name: philgeps-frontend-network

# ==============================================================================
# Notes:
# ==============================================================================
#
# 1. Build with custom backend URL:
#    VITE_API_URL=https://api.philgeps.simple-systems.dev docker compose -f docker-compose.frontend.yml build
#
# 2. Deploy frontend:
#    docker compose -f docker-compose.frontend.yml up -d
#
# 3. Frontend expects backend at VITE_API_URL
#    Make sure CORS is configured on backend to allow frontend domain
#
# 4. For production:
#    - Set VITE_API_URL to your backend domain (with https://)
#    - Ensure backend's CORS_ALLOWED_ORIGINS includes frontend domain
#
# 5. View logs:
#    docker compose -f docker-compose.frontend.yml logs -f
#
# ==============================================================================

